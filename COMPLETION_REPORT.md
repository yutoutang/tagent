# æ„å›¾æ³¨å†Œä¸åŠ è½½ç³»ç»Ÿ - å®ŒæˆæŠ¥å‘Š

## âœ… é¡¹ç›®çŠ¶æ€ï¼šå·²å®Œæˆ

å‚è€ƒ Dify å’Œ n8n çš„è®¾è®¡ç†å¿µï¼ŒæˆåŠŸä¸º LangGraph agent æ¡†æ¶å®ç°äº†ä¸€å¥—å®Œæ•´çš„**æ„å›¾æ³¨å†Œä¸åŠ è½½ç³»ç»Ÿ**ï¼

---

## ğŸ“Š å®Œæˆç»Ÿè®¡

| é¡¹ç›® | æ•°é‡ |
|------|------|
| æ–°å¢ Python æ–‡ä»¶ | 17 ä¸ª |
| æ–°å¢æ–‡æ¡£æ–‡ä»¶ | 4 ä¸ª |
| æ€»ä»£ç è¡Œæ•° | ~4,000 è¡Œ |
| æ ¸å¿ƒæ¨¡å— | 6 ä¸ª |
| å†…ç½®æ„å›¾ | 6 ä¸ª |
| ç¤ºä¾‹ä»£ç  | 3 ä¸ª |

---

## ğŸ¯ å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### âœ… 1. æ„å›¾æ³¨å†Œç³»ç»Ÿ

- **æ„å›¾å®šä¹‰**: å®Œæ•´çš„ IntentMetadataã€InputOutputSchemaã€IntentDefinition
- **æ³¨å†Œè¡¨**: IntentRegistry æ”¯æŒæ³¨å†Œã€æŸ¥è¯¢ã€ä¾èµ–éªŒè¯
- **ç±»å‹å®‰å…¨**: åŸºäº Pydantic çš„å®Œæ•´æ•°æ®éªŒè¯

### âœ… 2. æ„å›¾è§£æä¸è¯†åˆ«

- **LLM é©±åŠ¨**: ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºæ™ºèƒ½è§£æç”¨æˆ·è¾“å…¥
- **å¤šæ„å›¾è¯†åˆ«**: è¯†åˆ«ä¸»è¦æ„å›¾å’Œå­æ„å›¾
- **å‚æ•°æå–**: è‡ªåŠ¨æå–æ¯ä¸ªæ„å›¾çš„å‚æ•°
- **ä¾èµ–è¯†åˆ«**: ç†è§£æ„å›¾é—´çš„ä¾èµ–å…³ç³»

### âœ… 3. æ„å›¾ç¼–æ’å¼•æ“

- **ä¾èµ–å›¾æ„å»º**: æ„å»ºæ„å›¾é—´çš„ DAG
- **æ‹“æ‰‘æ’åº**: ä½¿ç”¨ Kahn ç®—æ³•ç¡®å®šæ‰§è¡Œé¡ºåº
- **åˆ†å±‚æ‰§è¡Œ**: è¯†åˆ«å¯å¹¶è¡Œæ‰§è¡Œçš„æ„å›¾å±‚
- **æ•°æ®æ˜ å°„**: ç”Ÿæˆæ„å›¾é—´çš„æ•°æ®æµè½¬æ˜ å°„

### âœ… 4. æ•°æ®æµè½¬ç³»ç»Ÿ

- **è¡¨è¾¾å¼è§£æ**: æ”¯æŒ n8n é£æ ¼çš„ `{{ $json.field }}` è¯­æ³•
- **æ•°æ®è½¬æ¢**: å­—æ®µæ˜ å°„ã€è¿‡æ»¤ã€èšåˆ
- **åµŒå¥—è·¯å¾„**: æ”¯æŒå¤æ‚æ•°æ®è·¯å¾„è®¿é—®

### âœ… 5. æ‰§è¡Œç³»ç»Ÿ

- **åŒæ­¥/å¼‚æ­¥**: å®Œæ•´çš„å¼‚æ­¥æ”¯æŒ
- **å¹¶è¡Œæ‰§è¡Œ**: ç‹¬ç«‹æ„å›¾å¹¶è¡Œå¤„ç†
- **é”™è¯¯å¤„ç†**: è¶…æ—¶æ§åˆ¶ã€è‡ªåŠ¨é‡è¯•ã€ä¼˜é›…é™çº§
- **æ‰§è¡Œè¿½è¸ª**: å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—

### âœ… 6. æ¡†æ¶é›†æˆ

- **IntentEnhancedAgent**: æ„å›¾å¢å¼ºçš„ Agent
- **å‘åå…¼å®¹**: ä¿æŒä¸åŸæ¡†æ¶å…¼å®¹
- **æ— ç¼é›†æˆ**: æ‰©å±•ç°æœ‰å·¥ä½œæµ

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ¨¡å— (intent_system/)
```
intent_system/
â”œâ”€â”€ __init__.py                      # æ¨¡å—å…¥å£
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ intent_definition.py         # æ„å›¾å®šä¹‰ (370è¡Œ)
â”‚   â”œâ”€â”€ intent_registry.py          # æ³¨å†Œè¡¨ (260è¡Œ)
â”‚   â”œâ”€â”€ intent_parser.py            # è§£æå™¨ (280è¡Œ)
â”‚   â””â”€â”€ state.py                     # çŠ¶æ€å®šä¹‰ (150è¡Œ)
â”œâ”€â”€ orchestration/
â”‚   â””â”€â”€ orchestrator.py             # ç¼–æ’å¼•æ“ (340è¡Œ)
â”œâ”€â”€ data_flow/
â”‚   â””â”€â”€ data_flow_engine.py         # æ•°æ®æµè½¬ (380è¡Œ)
â”œâ”€â”€ execution/
â”‚   â”œâ”€â”€ execution_tracker.py        # æ‰§è¡Œè¿½è¸ª (200è¡Œ)
â”‚   â””â”€â”€ intent_executor.py          # æ‰§è¡Œå™¨ (320è¡Œ)
â””â”€â”€ builtin_intents/
    â””â”€â”€ data_intents.py             # å†…ç½®æ„å›¾ (330è¡Œ)
```

### ç¤ºä¾‹ä»£ç  (examples/)
```
examples/
â”œâ”€â”€ intent_basic_usage.py           # åŸºæœ¬ç”¨æ³• (220è¡Œ)
â””â”€â”€ custom_intent.py                # è‡ªå®šä¹‰æ„å›¾ (240è¡Œ)
```

### é›†æˆä¸æ–‡æ¡£
```
agent-f/
â”œâ”€â”€ intent_system_integration.py    # æ¡†æ¶é›†æˆ (250è¡Œ)
â”œâ”€â”€ INTENT_SYSTEM_README.md         # ä½¿ç”¨æ–‡æ¡£ (480è¡Œ)
â”œâ”€â”€ INTENT_SYSTEM_SUMMARY.md        # å®ç°æ€»ç»“ (280è¡Œ)
â””â”€â”€ COMPLETION_REPORT.md            # æœ¬æ–‡æ¡£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œç¤ºä¾‹

```bash
# åŸºæœ¬ç”¨æ³•
python examples/intent_basic_usage.py

# è‡ªå®šä¹‰æ„å›¾
python examples/custom_intent.py

# æ¡†æ¶é›†æˆ
python intent_system_integration.py
```

### 2. åŸºæœ¬ä½¿ç”¨

```python
import asyncio
from intent_system.core import IntentRegistry
from intent_system.core.intent_parser import IntentParser
from intent_system.orchestration import IntentOrchestrator
from intent_system.execution import IntentExecutor
from intent_system.builtin_intents import register_builtin_data_intents

async def main():
    # åˆå§‹åŒ–
    registry = IntentRegistry()
    register_builtin_data_intents(registry)
    
    llm = create_llm()
    parser = IntentParser(llm, registry)
    orchestrator = IntentOrchestrator(registry)
    executor = IntentExecutor(registry)
    
    # è§£æç”¨æˆ·è¾“å…¥
    result = parser.parse("è®¡ç®— 25 * 4")
    print(f"è¯†åˆ«æ„å›¾: {result.primary_intent}")
    
    # ç¼–æ’æ‰§è¡Œè®¡åˆ’
    plan = orchestrator.orchestrate(result)
    
    # æ‰§è¡Œ
    results = await executor.execute_plan_async(plan)
    print(f"æ‰§è¡Œç»“æœ: {results}")

asyncio.run(main())
```

---

## ğŸ“ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### ä» n8n å­¦ä¹ 

- âœ… èŠ‚ç‚¹æ¨¡å—åŒ–æ³¨å†Œ
- âœ… `{{ $json.field }}` æ•°æ®æ˜ å°„è¯­æ³•
- âœ… å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›
- âœ… è¡¨è¾¾å¼è¯­è¨€æ”¯æŒ

### ä» Dify å­¦ä¹ 

- âœ… å›¾å¼•æ“æ¶æ„
- âœ… äº‹ä»¶é©±åŠ¨æ‰§è¡Œ
- âœ… JSON Schema æ¥å£å®šä¹‰
- âœ… ä¾èµ–å…³ç³»ç®¡ç†

### ä¸ LangGraph é›†æˆ

- âœ… åŸºäº StateGraph çš„çŠ¶æ€ç®¡ç†
- âœ… ä½¿ç”¨ Reducers æ¨¡å¼
- âœ… äº”èŠ‚ç‚¹å·¥ä½œæµæ‰©å±•
- âœ… å®Œå…¨å‘åå…¼å®¹

---

## ğŸ“Š å†…ç½®æ„å›¾

| æ„å›¾ID | åŠŸèƒ½ | ç±»åˆ« | è¯´æ˜ |
|--------|------|------|------|
| `http_request` | HTTP è¯·æ±‚ | data | å‘é€ HTTP è¯·æ±‚è·å–æ•°æ® |
| `calculator` | è®¡ç®—å™¨ | transform | è®¡ç®—æ•°å­¦è¡¨è¾¾å¼ |
| `web_search` | ç½‘ç»œæœç´¢ | data | æœç´¢ç½‘ç»œä¿¡æ¯ |
| `data_analysis` | æ•°æ®åˆ†æ | transform | åˆ†ææ•°æ®ç»Ÿè®¡ä¿¡æ¯ |
| `text_processing` | æ–‡æœ¬å¤„ç† | transform | å¤„ç†æ–‡æœ¬æ•°æ® |
| `file_read` | æ–‡ä»¶è¯»å– | data | è¯»å–æ–‡ä»¶å†…å®¹ |

---

## ğŸŒŸ å…³é”®ç‰¹æ€§

### 1. å¤šæ„å›¾è¯†åˆ«

```python
# ç”¨æˆ·è¾“å…¥
"å¸®æˆ‘è®¡ç®— 25 * 4ï¼ŒåŒæ—¶æœç´¢ Python ä¿¡æ¯"

# ç³»ç»Ÿè¯†åˆ«
primary_intent: "calculator"
sub_intents: [
    {"id": "web_search", "parameters": {"query": "Python"}}
]

# å¹¶è¡Œæ‰§è¡Œ
execution_layers: [
    ["calculator", "web_search"]  # å¹¶è¡Œ
]
```

### 2. æ„å›¾ä¾èµ–ç®¡ç†

```python
# å®šä¹‰ä¾èµ–
intent_b = IntentDefinition(
    metadata=IntentMetadata(
        dependencies=["intent_a"]
    ),
    ...
)

# è‡ªåŠ¨ç¼–æ’
execution_layers: [
    ["intent_a"],     # å…ˆæ‰§è¡Œ A
    ["intent_b"]      # å†æ‰§è¡Œ Bï¼ˆä¾èµ– A çš„è¾“å‡ºï¼‰
]
```

### 3. æ•°æ®æµè½¬

```python
# n8n é£æ ¼è¡¨è¾¾å¼
mapping = {
    "temperature": "{{ $json.temperature }}",
    "city": "{{ $json.city }}"
}

# è‡ªåŠ¨è§£æ
resolved = data_flow.resolve_mapping(mapping, previous_results)
```

### 4. æ‰§è¡Œè¿½è¸ª

```python
# å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—
summary = executor.get_execution_summary()
{
    "total_intents": 3,
    "successful": 3,
    "failed": 0,
    "total_duration": 2.5,
    "intents": [...]
}
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: å•æ„å›¾æ‰§è¡Œ
```
è¾“å…¥: "è®¡ç®— 25 * 4"
è¯†åˆ«: calculator
æ‰§è¡Œ: {"result": 100.0}
```

### åœºæ™¯ 2: å¤šæ„å›¾å¹¶è¡Œ
```
è¾“å…¥: "åŒæ—¶è®¡ç®— 100/5ã€æœç´¢ Pythonã€å¤„ç†æ–‡æœ¬"
è¯†åˆ«: calculator, web_search, text_processing
æ‰§è¡Œ: ä¸‰ä¸ªæ„å›¾å¹¶è¡Œ
```

### åœºæ™¯ 3: ä¾èµ–æ‰§è¡Œ
```
è¾“å…¥: "è·å–å¤©æ°”ï¼Œç„¶ååˆ†æ"
è¯†åˆ«: weather_fetch (ä¾èµ–) â†’ weather_analyze
æ‰§è¡Œ: æŒ‰é¡ºåºæ‰§è¡Œï¼Œæ•°æ®æµè½¬
```

---

## ğŸ“š æ–‡æ¡£

- **INTENT_SYSTEM_README.md** - å®Œæ•´ä½¿ç”¨æŒ‡å—
- **INTENT_SYSTEM_SUMMARY.md** - å®ç°æ€»ç»“
- **å„æ¨¡å— docstring** - API è¯¦ç»†æ–‡æ¡£

---

## ğŸ¯ ä½¿ç”¨ä»·å€¼

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œä½ å¯ä»¥ï¼š

1. **ç®€åŒ–å¤æ‚ä»»åŠ¡** - å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªæ„å›¾
2. **æé«˜æ•ˆç‡** - è‡ªåŠ¨è¯†åˆ«å¹¶è¡Œæ‰§è¡Œæœºä¼š
3. **é™ä½æˆæœ¬** - æ™ºèƒ½ç¼–æ’å‡å°‘å†—ä½™æ‰§è¡Œ
4. **æ˜“äºæ‰©å±•** - æ·»åŠ æ–°æ„å›¾åªéœ€å‡ è¡Œä»£ç 
5. **å¯ç»´æŠ¤æ€§** - æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡
6. **å¯è°ƒè¯•æ€§** - å®Œæ•´çš„æ‰§è¡Œè¿½è¸ª

---

## ğŸ”„ ä¸åŸæ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | åŸæ¡†æ¶ | æ–°æ¡†æ¶ |
|------|--------|--------|
| ä»»åŠ¡è¯†åˆ« | å•ä¸€ä»»åŠ¡ç±»å‹ | å¤šæ„å›¾è¯†åˆ« |
| å·¥å…·ç®¡ç† | æŒ‰ç±»å‹åŠ è½½ | æ„å›¾æ³¨å†Œè¡¨ |
| æ‰§è¡Œæ¨¡å¼ | ä¸²è¡Œä¸ºä¸» | æ™ºèƒ½å¹¶è¡Œ |
| æ•°æ®æµè½¬ | åŸºç¡€ä¼ é€’ | è¡¨è¾¾å¼æ˜ å°„ |
| æ‰§è¡Œè¿½è¸ª | éƒ¨åˆ†æ”¯æŒ | å®Œæ•´è¿½è¸ª |
| ä¾èµ–ç®¡ç† | æ—  | è‡ªåŠ¨ä¾èµ–è§£æ |
| å¯æ‰©å±•æ€§ | ä¸­ç­‰ | é«˜åº¦æ¨¡å—åŒ– |

---

## âœ¨ æŠ€æœ¯äº®ç‚¹

1. **LLM é©±åŠ¨çš„æ™ºèƒ½è§£æ** - ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºå‡†ç¡®è¯†åˆ«æ„å›¾
2. **DAG ç¼–æ’ç®—æ³•** - Kahn ç®—æ³•ç¡®ä¿æ­£ç¡®çš„æ‰§è¡Œé¡ºåº
3. **åˆ†å±‚å¹¶è¡Œæ‰§è¡Œ** - æœ€å¤§åŒ–å¹¶è¡Œåº¦æå‡æ•ˆç‡
4. **n8n é£æ ¼è¡¨è¾¾å¼** - çµæ´»çš„æ•°æ®æ˜ å°„è¯­æ³•
5. **å®Œæ•´çš„å¼‚æ­¥æ”¯æŒ** - asyncio å®ç°é«˜æ€§èƒ½æ‰§è¡Œ
6. **ç±»å‹å®‰å…¨ä¿éšœ** - Pydantic æä¾›å®Œæ•´çš„æ•°æ®éªŒè¯

---

## ğŸ‰ é¡¹ç›®æˆæœ

æˆåŠŸå®ç°äº†ä¸€ä¸ªï¼š

- âœ… **ç”Ÿäº§çº§** çš„æ„å›¾ç®¡ç†ç³»ç»Ÿ
- âœ… **é«˜åº¦å¯æ‰©å±•** çš„æ¨¡å—åŒ–æ¶æ„
- âœ… **ç”¨æˆ·å‹å¥½** çš„ API æ¥å£
- âœ… **æ€§èƒ½ä¼˜åŒ–** çš„å¹¶è¡Œæ‰§è¡Œ
- âœ… **å®Œå…¨å…¼å®¹** çš„æ¡†æ¶é›†æˆ
- âœ… **æ–‡æ¡£å®Œå–„** çš„ä½¿ç”¨æŒ‡å—

---

## ğŸ“ å¿«é€Ÿé“¾æ¥

- **è¿è¡Œç¤ºä¾‹**: `python examples/intent_basic_usage.py`
- **ä½¿ç”¨æ–‡æ¡£**: æŸ¥çœ‹ `INTENT_SYSTEM_README.md`
- **è‡ªå®šä¹‰æ„å›¾**: å‚è€ƒ `examples/custom_intent.py`
- **æ¡†æ¶é›†æˆ**: æŸ¥çœ‹ `intent_system_integration.py`

---

**é¡¹ç›®çŠ¶æ€**: âœ… å®Œæˆå¹¶å¯ç”¨  
**ç‰ˆæœ¬**: 1.0.0  
**å®Œæˆæ—¥æœŸ**: 2026-02-03  
**å®ç°æ–¹å¼**: Python + LangGraph + LangChain

---

æ„Ÿè°¢ä½¿ç”¨æ„å›¾æ³¨å†Œä¸åŠ è½½ç³»ç»Ÿï¼ğŸš€
